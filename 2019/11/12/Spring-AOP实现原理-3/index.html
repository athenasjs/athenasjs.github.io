<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="renderer" content="webkit">

  
  <title>Spring-AOP实现原理-2 | 孙建树的技术博客</title>

  <link rel="shortcut icon" href="/images/favicon.jpg">
  <link rel="alternate" href="/atom.xml" title="孙建树的技术博客">
  <meta name="description" content="创建AOP代理AOP的核心逻辑是在AnnotationAwareAspectJAutoProxyCreator类里面实现，先看看这个类的层次关系：    我们可以看到这个类实现了BeanPostProcessor接口，那就意味着这个类在Spring加载实例化前会调用postProcessAfterInitialization方法，对于AOP的逻辑也是由此开始的。 流程说明1) Spring容器启动">
<meta name="keywords" content="Spring,AOP">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring-AOP实现原理-2">
<meta property="og:url" content="http:&#x2F;&#x2F;athenasjs.github.io&#x2F;2019&#x2F;11&#x2F;12&#x2F;Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3&#x2F;index.html">
<meta property="og:site_name" content="孙建树的技术博客">
<meta property="og:description" content="创建AOP代理AOP的核心逻辑是在AnnotationAwareAspectJAutoProxyCreator类里面实现，先看看这个类的层次关系：    我们可以看到这个类实现了BeanPostProcessor接口，那就意味着这个类在Spring加载实例化前会调用postProcessAfterInitialization方法，对于AOP的逻辑也是由此开始的。 流程说明1) Spring容器启动">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;athenasjs.github.io&#x2F;images&#x2F;20160421184334804.png">
<meta property="og:updated_time" content="2019-11-12T14:33:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;athenasjs.github.io&#x2F;images&#x2F;20160421184334804.png">

  <meta name="format-detection" content="telephone=no,email=no">
  <meta name="theme-color" content="#9C27B0">
  <meta name="description" content="">
  <meta name="keywords" content=",Spring,AOP">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="孙建树的技术博客">
  <meta name="msapplication-starturl" content="http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/">
  <meta name="msapplication-navbutton-color" content="#9C27B0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="孙建树的技术博客">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/images/favicon.jpg">

  
    <meta property="article:published_time" content="Tue Nov 12 2019 20:39:25 GMT+0800">
    <meta property="article:modified_time" content="Tue Nov 12 2019 22:33:51 GMT+0800">
  

  
    <link rel="canonical" href="http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/">
  

  <meta name="google-site-verification" content="fXjtlIfaDc_X-0P11rO3bEp1Nk4IKXphoJv0GqGZCco">
  <meta name="baidu-site-verification" content="I3t1wfwZvd">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create','UA-139531378-1','auto');ga('send','pageview');
</script>
  <script>
  var _hmt = _hmt || [];
  (function() {var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?1054d51c0b66f1d168829173682c8159';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script>
  

  <link rel="stylesheet" href="/css/mdui.css">
<link rel="stylesheet" href="/css/style.css">
</head>
<body class="mdui-appbar-with-toolbar mdui-drawer-body-left mdui-theme-primary-indigo mdui-theme-accent-pink">
  <script>var a=localStorage.getItem("mdui-theme-layout-dark");if(a){document.getElementsByTagName("body")[0].className+=" mdui-theme-layout-dark"};</script>
  <header id="header" class="mdui-appbar mdui-appbar-fixed mdui-appbar-scroll-hide mdui-appbar-inset">
  <div class="mdui-toolbar mdui-color-theme">
    <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="mdui-icon material-icons">menu</i></a>
    <a href="/" class="mdui-typo-headline">孙建树的技术博客</a>
    <div class="mdui-toolbar-spacer"></div>
    <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: '搜索'}"><i class="mdui-icon material-icons">search</i></a>
    <a href="/atom.xml" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'RSS'}"><i class="mdui-icon material-icons">rss_feed</i></a>
  </div>
</header>
<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>
  <aside id="sidebar" class="mdui-drawer mdui-drawer-full-height">
  <div class="mdui-grid-tile">
    <img src="/images/banner.jpg" style="height: 160px;">
    <img src="/images/avatar.jpg" class="avatar-animation" style="position: absolute; top: 10%; left: 24px; width: 64px; height: 64px; border: 2px solid #fff; border-radius: 50%;">
    <div class="mdui-grid-tile-actions">
      <div class="mdui-grid-tile-text">
        <div class="mdui-grid-tile-title">孙建树</div>
        <div class="mdui-grid-tile-subtitle"><i class="mdui-icon material-icons">art_track</i>桃李不言，下自成蹊</div>
      </div>
      
        <div class="mdui-grid-tile-buttons">
          <a href="mailto:sjswhut@163.com" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'sjswhut@163.com'}"><i class="mdui-icon material-icons">email</i></a>
        </div>
      
    </div>
  </div>

  <div class="mdui-list" mdui-collapse="{accordion: true}">
    <a href="/" class="mdui-list-item mdui-ripple">
      <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">home</i>
      <div class="mdui-list-item-content">主页</div>
    </a>
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-deep-orange">inbox</i>
        <div class="mdui-list-item-content">归档</div>
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
        <a class="mdui-ripple sidebar_archives-link" href="/archives/2019/11/">十一月 2019<span class="mdui-ripple sidebar_archives-count">12</span></a>
        
      </div>
    </div>
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-green">chrome_reader_mode</i>
        <div class="mdui-list-item-content">分类</div>
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
        <a class="mdui-ripple sidebar_archives-link" href="/categories/Spring%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">Spring读书笔记<span class="mdui-ripple sidebar_archives-count">6</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/tomcat%E7%B1%BB/">tomcat类<span class="mdui-ripple sidebar_archives-count">2</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/">默认分类<span class="mdui-ripple sidebar_archives-count">1</span></a>
        
      </div>
    </div>
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-brown">bookmark</i>
        <div class="mdui-list-item-content">标签</div>
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
        <a class="mdui-ripple sidebar_archives-link" href="/tags/AOP/" rel="tag">AOP<span class="mdui-ripple sidebar_archives-count">3</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/IOC/" rel="tag">IOC<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/Spring/" rel="tag">Spring<span class="mdui-ripple sidebar_archives-count">6</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/nginx/" rel="tag">nginx<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/spring/" rel="tag">spring<span class="mdui-ripple sidebar_archives-count">2</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/springMVC/" rel="tag">springMVC<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/tomcat/" rel="tag">tomcat<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/zookeeper/" rel="tag">zookeeper<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/" rel="tag">数据库事务<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" rel="tag">网络基础<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/" rel="tag">计算机网络相关<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式<span class="mdui-ripple sidebar_archives-count">2</span></a>
        
      </div>
    </div>
    <a href="/about" class="mdui-list-item mdui-ripple">
      <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-purple">person</i>
      <div class="mdui-list-item-content">关于</div>
    </a>
  </div>

  <div class="mdui-divider"></div>

  <div class="mdui-list" mdui-collapse="{accordion: true}">
    
      <a href="/tagcloud" class="mdui-list-item mdui-ripple">标签云</a>
    
    <div class="mdui-collapse-item">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <div class="mdui-list-item-content">友情链接</div>
        <i class="mdui-list-item-icon mdui-icon material-icons">link</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
        
          <a href="https://github.com" target="_blank" class="mdui-list-item mdui-ripple mdui-p-l-2 mdui-text-color-theme-accent" style="justify-content: center;">Github</a>
        
        
      </div>
    </div>
  </div>
</aside>
  <main id="main" class="mdui-m-t-5 fadeIn animated">
  <link rel="stylesheet" href="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css">
  <style>#main article .mdui-card-content .center-block{display:block!important;margin-right:auto!important;margin-left:auto!important}</style>
  <article class="mdui-card mdui-m-b-5">
    <header class="mdui-card-media">
      <img src="/images/random/material-4.png" style="max-height: 240px;">
      <div class="mdui-card-media-covered">
        <div class="mdui-card-primary">
          <div class="mdui-card-primary-title">Spring-AOP实现原理-2</div>
          <div class="mdui-card-primary-subtitle"><i class="iconfont">&#xe697;</i> 2019-11-12 / <i class="iconfont">&#xe601;</i> 孙建树</div>
        </div>
      </div>
      <div class="mdui-card-menu">
        
          <button class="mdui-btn mdui-btn-icon mdui-text-color-white" mdui-menu="{target: '#qrcode', align: 'right'}"><i class="mdui-icon material-icons">devices</i></button>
          <ul class="mdui-menu" id="qrcode">
            
              <li class="mdui-menu-item"><a class="mdui-text-center mdui-ripple">发送到手机</a></li>
            
            <li class="mdui-menu-item" disabled>
              
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAADkElEQVR42u3aS47jMAwFwL7/pWe2DTSSvEdKgRelVRA4sVRe0Pz8/LN+rR8EOHDgwIEDBw4cOHA8mOMnXn9/9f5ze/2rO776JvmH6Cw4cODAgeMCx4dQ9ILj1Q2Sa9rftujFWXDgwIEDxzWO5PbJ5pLDt4G8PWpOiQMHDhw4nsmRJEtJoG2TullCiAMHDhw4nsyRJ2AJQZtGPi7Q4sCBAweOUWo0S8Pa4mCyw/xKHDhw4MDxTY48ND7/81fnO3DgwIEDxx+OdrUhcBakkwJi3o76cCIcOHDgwHGUY9ZAygNwC9eG/AMNMBw4cODAcZRjE2jfH3U/MNc+ttldcODAgQPHWY5ZWJ2lcAlZMkKxb4PhwIEDB457HO0owIHbj0qE7atAMiSHAwcOHDjuccySsXYr+ZD0qTHuiBsHDhw4cBzl2IexTfMpD/DtgEWRiOLAgQMHjgscyTham27lm8uD7qlGFA4cOHDguMfRBsIZX1vIi45R3uvlHnDgwIEDxwWONozNjjSjyUuH76/HgQMHDhzf5NiU82bFwWjUIMbN07YPxUEcOHDgwHGIIx8saFtECcEMMfmf1eQgDhw4cOAYcZxqKbXlufwu+SGHwRsHDhw4cHyFow1vw/QpeBh5YTF/gcCBAwcOHN/haBOttqi3SRpzuPoh4cCBAweOoxztpvP2z35Ion1geQDGgQMHDhz3OG6H0vcbzQ+2+ee6OIgDBw4cOBYc+e33rankeG2Zsi0OFu8dOHDgwIFjxJGHt9kBksRvlrbl1wzfO3DgwIEDxyGOs8nYPiTPhufyU+DAgQMHjrMcbejK21H7tHAWaNuhcBw4cODAcY9j1hBqC3n5b9tBill6iQMHDhw4znLs2zyzQYQ2hTt1TZTR4sCBAweONUeeJm3KdptBh1kDLHpIOHDgwIHjMsds8Hoz1nAjAOPAgQMHjidwbIJZcsjN8EFSKEwWDhw4cOC4zdGu9qjt5yQBm5Uviy4cDhw4cOBYcGxC1KyMmH+/H2uI4HDgwIEDxwWO2SBCvsWWezYk8f6F4GUqiAMHDhw4rnHMAlgbdDetrLzdVTTPcODAgQPHYzg2zaEkKCYhM0nVPqSgOHDgwIHjkRx5MM758mSsLWjiwIEDB47vcGw2vRmPyNO5tjUVlRFx4MCBA8cFjrwtVAwKxL/alPaSAmWdwuHAgQMHjgWHhQMHDhw4cODAgQMHjoet/5QJaNENyAX2AAAAAElFTkSuQmCC">
              
            </li>
          </ul>
        
        
          <button class="mdui-btn mdui-btn-icon mdui-text-color-white" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="mdui-icon material-icons">share</i></button>
          <ul class="mdui-menu" id="share_menu">
            <li class="mdui-menu-item">
              <a href="http://service.weibo.com/share/share.php?appkey=&title=Spring-AOP实现原理-2&url=http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/&pic=http://athenasjs.github.io/images/favicon.jpg&searchPic=false&style=simple" target="_blank" class="mdui-ripple">分享到微博</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://twitter.com/intent/tweet?text=Spring-AOP实现原理-2&url=http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/&via=孙建树" target="_blank" class="mdui-ripple">分享到Twitter</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://www.facebook.com/sharer/sharer.php?u=http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/" target="_blank" class="mdui-ripple">分享到Facebook</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://plus.google.com/share?url=http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/" target="_blank" class="mdui-ripple">分享到Google+</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/&title=Spring-AOP实现原理-2" target="_blank" class="mdui-ripple">分享到LinkedIn</a>
            </li>
            <li class="mdui-menu-item">
              <a href="http://connect.qq.com/widget/shareqq/index.html?site=孙建树的技术博客&title=Spring-AOP实现原理-2&summary=&pics=http://athenasjs.github.io/images/favicon.jpg&url=http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/" target="_blank" class="mdui-ripple">分享到QQ</a>
            </li>
            <li class="mdui-menu-item">
              <a href="https://telegram.me/share/url?url=http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/&text=Spring-AOP实现原理-2" target="_blank" class="mdui-ripple">分享到Telegram</a>
            </li>
          </ul>
        
      </div>
    </header>
    <div class="mdui-card-content mdui-typo">
      <h3 id="创建AOP代理"><a href="#创建AOP代理" class="headerlink" title="创建AOP代理"></a>创建AOP代理</h3><p>AOP的核心逻辑是在AnnotationAwareAspectJAutoProxyCreator类里面实现，先看看这个类的层次关系：</p>
<center> <img src="/images/20160421184334804.png" width = 60% height = 60% /></center>

<p>我们可以看到这个类实现了BeanPostProcessor接口，那就意味着这个类在Spring加载实例化前会调用postProcessAfterInitialization方法，对于AOP的逻辑也是由此开始的。</p>
<h4 id="流程说明"><a href="#流程说明" class="headerlink" title="流程说明"></a>流程说明</h4><p>1) Spring容器启动，每个bean的实例化前都会先经过AbstractAutoProxyCreator类的postProcessorAfterInitialization()方法，接下来是调用wrapIfNecessary()方法，对目标bean进行封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create a proxy with the configured interceptors if the bean is</span></span><br><span class="line"><span class="comment"> * identified as one to proxy by the subclass.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getAdvicesAndAdvisorsForBean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public Object &lt;strong&gt;postProcessAfterInitialization&lt;/strong&gt;(Object bean, String beanName) throws BeansException &#123;</span><br><span class="line">	<span class="keyword">if</span> (bean != <span class="keyword">null</span>) &#123;</span><br><span class="line">		Object cacheKey = getCacheKey(bean.getClass(), beanName);</span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>.earlyProxyReferences.containsKey(cacheKey)) &#123;</span><br><span class="line">			<span class="keyword">return</span> wrapIfNecessary(bean, beanName, cacheKey);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2) 重点实现逻辑的方法getAdvicesAndAdvisorsForBean，这个方法会提取当前系统中的所有增强方法（切面逻辑），将其封装为Advisor对象，然后获取到适合当前bean的增强方法，并对增强方法进行排序，最后返回一个Advisor的数组，Spring AOP在为目标bean获取需要进行代理的切面逻辑的时候最终得到的是Advisor，这里Advice表示的是每个切面逻辑中使用的@Before、@After、@Around等需要织入的代理方法，因为每个代理方法都表示一个Advice，并且每个代理方法最终都会生成一个Advisor，Advice表示需要织入的切面逻辑，而Advisor表示将切面逻辑进行封装之后的织入者。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Wrap the given bean if necessary, i.e. if it is eligible for being proxied.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> bean the raw bean instance</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> beanName the name of the bean</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cacheKey the cache key for metadata access</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> a proxy wrapping the bean, or the raw bean instance as-is</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Object <span class="title">wrapIfNecessary</span><span class="params">(Object bean, String beanName, Object cacheKey)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (beanName != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.targetSourcedBeans.containsKey(beanName)) &#123;</span><br><span class="line">			<span class="keyword">return</span> bean;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (Boolean.FALSE.equals(<span class="keyword">this</span>.advisedBeans.get(cacheKey))) &#123;</span><br><span class="line">			<span class="keyword">return</span> bean;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) &#123;</span><br><span class="line">			<span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line">			<span class="keyword">return</span> bean;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// Create proxy if we have advice.	</span></span><br><span class="line">		Object[] specificInterceptors = &lt;strong&gt;getAdvicesAndAdvisorsForBean&lt;/strong&gt;(bean.getClass(), beanName, null);</span><br><span class="line">		<span class="keyword">if</span> (specificInterceptors != DO_NOT_PROXY) &#123;</span><br><span class="line">			<span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.TRUE);</span><br><span class="line">			Object proxy = createProxy(bean.getClass(), beanName, specificInterceptors, <span class="keyword">new</span> SingletonTargetSource(bean));</span><br><span class="line">			<span class="keyword">this</span>.proxyTypes.put(cacheKey, proxy.getClass());</span><br><span class="line">			<span class="keyword">return</span> proxy;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>3) 获取到当前bean的所有Advisor后，调用createProxy方法创建代理，先创建代理工厂proxyFactory，然后获取当前bean的增强器Advisor，把当前获取到的增强器添加到代理工厂proxyFactory，然后设置当前的代理工厂的目标对象为当前bean，最后根据配置创建JDK的动态代理工厂，或者CGLIB的动态代理工厂，创建代理对象。对于不同的AopProxy对象的生成，最终由Spring封装的JdkDynamicAopProxy和CglibProxyFactory类来完成。</p>
<h3 id="AOP动态代理执行"><a href="#AOP动态代理执行" class="headerlink" title="AOP动态代理执行"></a>AOP动态代理执行</h3><p>关于AOP的动态代理执行，有两种主要的方式JDK动态代理和CGLIB动态代理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AopProxy <span class="title">createAopProxy</span><span class="params">(AdvisedSupport config)</span> <span class="keyword">throws</span> AopConfigException </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123;</span><br><span class="line">		Class targetClass = config.getTargetClass();</span><br><span class="line">		<span class="keyword">if</span> (targetClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">"TargetSource cannot determine target class: "</span> +</span><br><span class="line">					<span class="string">"Either an interface or a target is required for proxy creation."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (targetClass.isInterface()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> CglibProxyFactory.createCglibProxy(config);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据用户的配置（是否配置了proxyTargetClass属性为true）以及目标bean是否实现接口，选择创建的代理类型，下面根据JDK的动态代理来说明AOP的执行，先呈现JdkDynamicAopProxy的核心代码invoke方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> throwsThrowable </span>&#123;</span><br><span class="line">       MethodInvocation invocation = <span class="keyword">null</span>;</span><br><span class="line">       Object oldProxy = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">boolean</span> setProxyContext = <span class="keyword">false</span>;</span><br><span class="line"> </span><br><span class="line">       TargetSource targetSource = <span class="keyword">this</span>.advised.targetSource;</span><br><span class="line">       Class targetClass = <span class="keyword">null</span>;</span><br><span class="line">       Object target = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//eqauls()方法，具目标对象未实现此方法</span></span><br><span class="line">           <span class="keyword">if</span> (!<span class="keyword">this</span>.equalsDefined &amp;&amp; AopUtils.isEqualsMethod(method))&#123;</span><br><span class="line">                <span class="keyword">return</span> (equals(args[<span class="number">0</span>])? Boolean.TRUE : Boolean.FALSE);</span><br><span class="line">           &#125;</span><br><span class="line"> </span><br><span class="line">           <span class="comment">//hashCode()方法，具目标对象未实现此方法</span></span><br><span class="line">           <span class="keyword">if</span> (!<span class="keyword">this</span>.hashCodeDefined &amp;&amp; AopUtils.isHashCodeMethod(method))&#123;</span><br><span class="line">                <span class="keyword">return</span> newInteger(hashCode());</span><br><span class="line">           &#125;</span><br><span class="line"> </span><br><span class="line">           <span class="comment">//Advised接口或者其父接口中定义的方法,直接反射调用,不应用通知</span></span><br><span class="line">           <span class="keyword">if</span> (!<span class="keyword">this</span>.advised.opaque &amp;&amp;method.getDeclaringClass().isInterface()</span><br><span class="line">                    &amp;&amp;method.getDeclaringClass().isAssignableFrom(Advised<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">                <span class="comment">// Service invocations onProxyConfig with the proxy config...</span></span><br><span class="line">                <span class="keyword">return</span> AopUtils.invokeJoinpointUsingReflection(<span class="keyword">this</span>.advised,method, args);</span><br><span class="line">           &#125;</span><br><span class="line"> </span><br><span class="line">           Object retVal = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">this</span>.advised.exposeProxy) &#123;</span><br><span class="line">                <span class="comment">// Make invocation available ifnecessary.</span></span><br><span class="line">                oldProxy = AopContext.setCurrentProxy(proxy);</span><br><span class="line">                setProxyContext = <span class="keyword">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line"> </span><br><span class="line">           <span class="comment">//获得目标对象的类</span></span><br><span class="line">           target = targetSource.getTarget();</span><br><span class="line">           <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">                targetClass = target.getClass();</span><br><span class="line">           &#125;</span><br><span class="line"> </span><br><span class="line">           <span class="comment">//获取可以应用到此方法上的Interceptor列表</span></span><br><span class="line">           List chain = <span class="keyword">this</span>.advised.getInterceptorsAndDynamicInterceptionAdvice(method,targetClass);</span><br><span class="line"> </span><br><span class="line">           <span class="comment">//如果没有可以应用到此方法的通知(Interceptor)，此直接反射调用 method.invoke(target, args)</span></span><br><span class="line">           <span class="keyword">if</span> (chain.isEmpty()) &#123;</span><br><span class="line">                retVal = AopUtils.invokeJoinpointUsingReflection(target,method, args);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//创建MethodInvocation</span></span><br><span class="line">                invocation = newReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain);</span><br><span class="line">                retVal = invocation.proceed();</span><br><span class="line">           &#125;</span><br><span class="line"> </span><br><span class="line">           <span class="comment">// Massage return value if necessary.</span></span><br><span class="line">           <span class="keyword">if</span> (retVal != <span class="keyword">null</span> &amp;&amp; retVal == target &amp;&amp;method.getReturnType().isInstance(proxy)</span><br><span class="line">                    &amp;&amp;!RawTargetAccess<span class="class">.<span class="keyword">class</span>.<span class="title">isAssignableFrom</span>(<span class="title">method</span>.<span class="title">getDeclaringClass</span>())) </span>&#123;</span><br><span class="line">                <span class="comment">// Special case: it returned"this" and the return type of the method</span></span><br><span class="line">                <span class="comment">// is type-compatible. Notethat we can't help if the target sets</span></span><br><span class="line">                <span class="comment">// a reference to itself inanother returned object.</span></span><br><span class="line">                retVal = proxy;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> retVal;</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           <span class="keyword">if</span> (target != <span class="keyword">null</span> &amp;&amp; !targetSource.isStatic()) &#123;</span><br><span class="line">                <span class="comment">// Must have come fromTargetSource.</span></span><br><span class="line">               targetSource.releaseTarget(target);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (setProxyContext) &#123;</span><br><span class="line">                <span class="comment">// Restore old proxy.</span></span><br><span class="line">                AopContext.setCurrentProxy(oldProxy);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这个invoke方法是作为Proxy对象进行拦截的回调入口出现的，在这个方法里获取目标对象以及拦截器链，判断拦截器链是否为空，如果为空则直接调用切点方法，否则创建ReflectiveMethodInvocation类，完成对AOP功能实现的封装，在这个invoke方法中包含了一个完整的拦截器链对目标对象的拦截过程，逐个运行拦截器链里的拦截增强，直到最后对目标对象方法的运行等。对拦截器链的调用是在ReflectiveMethodInvocation中通过proceed方法实现的，在该方法中会逐个运行拦截器的拦截方法，在运行方法之前会对代理方法完成一个匹配判断，决定拦截器是否满足切面增强的要求，如果已经运行到拦截器链的末尾，那么就会直接调用目标对象的实现方法，否则沿着拦截器链继续进行，得到下一个拦截器，通过这个拦截器进行matches判断是否适用于横切增强的场合，如果是，从拦截器中得到通知器，启动invoke()方法进行切面增强，在这个过程结束以后会迭代调用proceed方法，知道拦截器链中所有的拦截器都完成以上的拦截过程为止。复杂的代理终于起到作用了。</p>
<h3 id="拦截器链的获取"><a href="#拦截器链的获取" class="headerlink" title="拦截器链的获取"></a>拦截器链的获取</h3><p>取得拦截器链的工作由AdvisorChainFactory完成，是一个生成通知器链的工厂，从提供的配置实例config中获取advisor列表，遍历处理这些advisor判断是否能应用到目标类或者目标方法上，将满足条件的Advisor通过适配器AdvisorAdaptor适配成拦截器Interceptor，将能够应用到连接点或者目标类的Advisor全部转化成MethodInterceptor，以MethodBeforeAdviceAdapter为例，实现AdvisorAdaptor接口两个方法：一是supportAdvice，对advice的类型做判断，另一个是getInterceptor接口方法的实现，把advice通知从Advisor中取出，然后创建一个MethodBeforeAdviceInterceptor对象，把取得的advice通知包装起来然后返回。Spring AOP为了实现advice的织入，设计了特定的拦截器对这些功能进行了封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 从提供的配置实例config中获取advisor列表,遍历处理这些advisor.如果是IntroductionAdvisor,</span></span><br><span class="line"><span class="comment">    * 则判断此Advisor能否应用到目标类targetClass上.如果是PointcutAdvisor,则判断</span></span><br><span class="line"><span class="comment">    * 此Advisor能否应用到目标方法method上.将满足条件的Advisor通过AdvisorAdaptor转化成Interceptor列表返回.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">publicList <span class="title">getInterceptorsAndDynamicInterceptionAdvice</span><span class="params">(Advised config, Methodmethod, Class targetClass)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// This is somewhat tricky... we have to process introductions first,</span></span><br><span class="line">       <span class="comment">// but we need to preserve order in the ultimate list.</span></span><br><span class="line">       List interceptorList = <span class="keyword">new</span> ArrayList(config.getAdvisors().length);</span><br><span class="line"> </span><br><span class="line">       <span class="comment">//查看是否包含IntroductionAdvisor</span></span><br><span class="line">       <span class="keyword">boolean</span> hasIntroductions = hasMatchingIntroductions(config,targetClass);</span><br><span class="line"> </span><br><span class="line">       <span class="comment">//这里实际上注册一系列AdvisorAdapter,用于将Advisor转化成MethodInterceptor</span></span><br><span class="line">       AdvisorAdapterRegistry registry = GlobalAdvisorAdapterRegistry.getInstance();</span><br><span class="line"> </span><br><span class="line">       Advisor[] advisors = config.getAdvisors();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;advisors.length; i++) &#123;</span><br><span class="line">           Advisor advisor = advisors[i];</span><br><span class="line">           <span class="keyword">if</span> (advisor <span class="keyword">instanceof</span> PointcutAdvisor) &#123;</span><br><span class="line">                <span class="comment">// Add it conditionally.</span></span><br><span class="line">                PointcutAdvisor pointcutAdvisor= (PointcutAdvisor) advisor;</span><br><span class="line">                <span class="keyword">if</span>(config.isPreFiltered() ||pointcutAdvisor.getPointcut().getClassFilter().matches(targetClass)) &#123;</span><br><span class="line">                    <span class="comment">//<span class="doctag">TODO:</span> 这个地方这两个方法的位置可以互换下</span></span><br><span class="line">                    <span class="comment">//将Advisor转化成Interceptor</span></span><br><span class="line">                    MethodInterceptor[]interceptors = registry.getInterceptors(advisor);</span><br><span class="line"> </span><br><span class="line">                    <span class="comment">//检查当前advisor的pointcut是否可以匹配当前方法</span></span><br><span class="line">                    MethodMatcher mm =pointcutAdvisor.getPointcut().getMethodMatcher();</span><br><span class="line"> </span><br><span class="line">                    <span class="keyword">if</span> (MethodMatchers.matches(mm,method, targetClass, hasIntroductions)) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(mm.isRuntime()) &#123;</span><br><span class="line">                            <span class="comment">// Creating a newobject instance in the getInterceptors() method</span></span><br><span class="line">                            <span class="comment">// isn't a problemas we normally cache created chains.</span></span><br><span class="line">                            <span class="keyword">for</span> (intj = <span class="number">0</span>; j &lt; interceptors.length; j++) &#123;</span><br><span class="line">                               interceptorList.add(<span class="keyword">new</span> InterceptorAndDynamicMethodMatcher(interceptors[j],mm));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            interceptorList.addAll(Arrays.asList(interceptors));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (advisor <span class="keyword">instanceof</span> IntroductionAdvisor)&#123;</span><br><span class="line">                IntroductionAdvisor ia =(IntroductionAdvisor) advisor;</span><br><span class="line">                <span class="keyword">if</span>(config.isPreFiltered() || ia.getClassFilter().matches(targetClass)) &#123;</span><br><span class="line">                    Interceptor[] interceptors= registry.getInterceptors(advisor);</span><br><span class="line">                    interceptorList.addAll(Arrays.asList(interceptors));</span><br><span class="line">                &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Interceptor[] interceptors =registry.getInterceptors(advisor);</span><br><span class="line">                interceptorList.addAll(Arrays.asList(interceptors));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> interceptorList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Spring-CGLIB动态代理实现"><a href="#Spring-CGLIB动态代理实现" class="headerlink" title="Spring CGLIB动态代理实现"></a>Spring CGLIB动态代理实现</h4><p>这两个代理的实现方式都差不多，都是创建方法调用链，不同的是jdk的动态代理创建的是ReflectiveMethodInvocation，而CGLIB 创建的是CglibMethodInvocation.</p>

      <blockquote class="mdui-m-t-5">
        
          <strong>本文遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">CC BY-NC-SA 4.0</a> 许可协议</strong><br>
        
        <strong>本文链接：</strong><a href="http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/">http://athenasjs.github.io/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3/</a>
      </blockquote>
      
    </div>
    <footer class="mdui-card-actions">
      
        <a class="mdui-ripple article_categories-link" href="/categories/Spring%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">Spring读书笔记</a>
      
      
        <a class="mdui-ripple article_tags-link" href="/tags/AOP/" rel="tag">AOP</a><a class="mdui-ripple article_tags-link" href="/tags/Spring/" rel="tag">Spring</a>
      
    </footer>
    
  </article>
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script>$("#main article .mdui-card-content img.fancybox").on("click",function(e){$.fancybox.open({src:$(this).attr("src")});});</script>


  <nav id="paginator">
    
      <a rel="prev" class="extend prev" href="/2019/11/13/Spring%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E8%AF%A6%E8%A7%A3/">
        <button aria-label="prev" class="mdui-btn mdui-btn-raised mdui-btn-dense mdui-btn-icon mdui-color-theme-accent mdui-ripple"><i class="mdui-icon material-icons">arrow_back</i></button>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上一篇
      </a>
    
    <div class="spacer"></div>
    
      <a rel="next" class="extend next" href="/2019/11/12/Spring-AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-2/">
        下一篇&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <button aria-label="next" class="mdui-btn mdui-btn-raised mdui-btn-dense mdui-btn-icon mdui-color-theme-accent mdui-ripple"><i class="mdui-icon material-icons">arrow_forward</i></button>
      </a>
    
  </nav>



</main>
  <footer id="footer" class="mdui-m-t-5 mdui-p-y-3 mdui-color-theme">
  <div class="mdui-p-y-0 mdui-text-center">
    
    
    
    
    
    
    
      <a href="https://github.com/athenasjs" target="_blank"><i class="mdui-p-a-1 mdui-icon iconfont mdui-text-color-theme-a100">&#xe7ab;</i></a>
    
    
    
      <a href="https://www.zhihu.com/people/sun-jian-shu-24/activities" target="_blank"><i class="mdui-p-a-1 mdui-icon iconfont mdui-text-color-theme-a100">&#xe6c0;</i></a>
    
    
    
    
  </div>
  <div class="mdui-p-y-1 mdui-text-center">
    Copyright &copy; 2019 - 2020 孙建树<br>
    Powered by <a href="https://hexo.io/" target="_blank" class="mdui-text-color-theme-accent">Hexo</a>
    
  </div>
</footer>
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-theme-accent"><i class="mdui-icon material-icons">arrow_upward</i></button>
  
  <script src="/js/mdui.js"></script>
<script src="/js/script.js"></script>
</body>
</html>